<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brickfolio</title>
    <link rel="icon" type="image/png" href="./favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./styles.css">
</head>

<body class="loading">

    <header>
        <h1>Brickfolio <span class="version-badge">BETA</span></h1>
        <div class="header-controls">
            <div class="view-toggles">
                <div class="toggle-btn" id="btnCurr" onclick="setMode('currency')">‚Ç™ Value</div>
                <div class="toggle-btn active" id="btnPct" onclick="setMode('percent')">% ROI</div>
            </div>
            <div class="util-btns">
                <button class="util-btn" onclick="toggleDarkMode()" title="Toggle dark mode">üåô</button>
                <button class="util-btn" onclick="printResults()" title="Print results">üñ®Ô∏è</button>
                <button class="util-btn" onclick="resetAll()" title="Reset to defaults">‚Ü∫</button>
            </div>
        </div>
    </header>

    <div class="layout">
        <div class="sidebar">
            <div class="sidebar-content">

                <div class="equity-box" id="equityBox">
                    <div class="card-lbl" style="color:#0369a1; margin-bottom:4px;">Starting Cash</div>
                    <input type="number" id="inpEquity" value="400000" step="10000" oninput="runSim()">
                </div>

                <div class="section-title">Deal Structure</div>
                <div class="control-card">
                    <div class="card-row"><span class="card-lbl">Buyer Type</span>
                        <select id="buyerType"
                            style="padding:6px; border-radius:6px; border:1px solid var(--border); font-weight:600; color:#475569;"
                            onchange="setBuyerType(this.value)">
                            <option value="first" selected>First Home (75% LTV)</option>
                            <option value="replacement">Replacement (70% LTV)</option>
                            <option value="investor">Investment (50% LTV)</option>
                        </select>
                    </div>
                    <div class="card-row"><span class="card-lbl">Down Payment <span class="lock-toggle" id="lockDownBtn"
                                onclick="toggleLock('down')">Free</span></span> <span class="card-val"
                            id="dDown">30%</span></div>
                    <div class="range-wrapper">
                        <input type="range" id="rDown" min="25" max="100" step="5" value="30" oninput="runSim()">
                        <div class="sweet-spot" id="spotDown"></div>
                    </div>

                    <div class="card-divider"></div>
                    <div class="card-row"><span class="card-lbl">Mortgage Mix (Tamheel)</span> <span class="card-val"
                            id="valMixSum" style="color:#16a34a; display:none;">100%</span></div>
                    <div class="scenario-grid" style="margin-bottom:10px;">
                        <div class="scen-btn" style="flex:1" onclick="applyTamheel('defaultEven')">üß≠ Default</div>
                    </div>
                    <div class="scenario-grid" style="margin-bottom:15px; margin-top:5px;">
                        <div class="scen-btn" onclick="applyTamheel('arbitrage')">üìâ Arbitrage</div>
                        <div class="scen-btn" onclick="applyTamheel('shield')">üõ°Ô∏è Shield</div>
                        <div class="scen-btn" onclick="applyTamheel('investor')">üí∏ Investor</div>
                    </div>
                    <div class="card-sub" style="display:flex; justify-content:space-between; align-items:end;">
                        <span>Mix Allocation</span>
                        <span class="rate-toggle-btn" onclick="toggleRateEdit()">Edit Rates</span>
                    </div>

                    <div class="mix-visual-bar" id="mixVisualBar">
                        <div class="mix-bar-seg" style="background:#3b82f6; width:33%"></div>
                        <div class="mix-bar-seg" style="background:#a855f7; width:34%"></div>
                        <div class="mix-bar-seg" style="background:#14b8a6; width:33%"></div>
                        <div class="mix-bar-seg" style="background:#f97316; width:0%"></div>
                        <div class="mix-bar-seg" style="background:#f43f5e; width:0%"></div>
                    </div>

                    <div class="mix-row">
                        <span class="track-badge" style="background:#3b82f6"></span>
                        <div class="mix-label">Prime</div>
                        <div class="mix-slider-container">
                            <input type="range" id="sliderPrime" min="0" max="100" step="1" value="34"
                                oninput="syncMixInput('Prime')">
                        </div>
                        <div class="mix-pct-val" id="dispPrime">34%</div>
                        <div class="mix-rate-box">
                            <span class="mix-rate-val" id="lblRatePrime" onclick="toggleRateEdit()">5.75%</span>
                            <input type="number" class="mix-rate-input" id="ratePrime" value="5.75" step="0.05"
                                oninput="runSim()">
                        </div>
                        <input type="hidden" id="pctPrime" value="34">
                    </div>

                    <div class="mix-row">
                        <span class="track-badge" style="background:#a855f7"></span>
                        <div class="mix-label">Kalats</div>
                        <div class="mix-slider-container">
                            <input type="range" id="sliderKalats" min="0" max="100" step="1" value="33"
                                oninput="syncMixInput('Kalats')">
                        </div>
                        <div class="mix-pct-val" id="dispKalats">33%</div>
                        <div class="mix-rate-box">
                            <span class="mix-rate-val" id="lblRateKalats" onclick="toggleRateEdit()">4.95%</span>
                            <input type="number" class="mix-rate-input" id="rateKalats" value="4.95" step="0.1"
                                oninput="runSim()">
                        </div>
                        <input type="hidden" id="pctKalats" value="33">
                    </div>

                    <div class="mix-row">
                        <span class="track-badge" style="background:#14b8a6"></span>
                        <div class="mix-label">Malatz</div>
                        <div class="mix-slider-container">
                            <input type="range" id="sliderMalatz" min="0" max="100" step="1" value="33"
                                oninput="syncMixInput('Malatz')">
                        </div>
                        <div class="mix-pct-val" id="dispMalatz">33%</div>
                        <div class="mix-rate-box">
                            <span class="mix-rate-val" id="lblRateMalatz" onclick="toggleRateEdit()">4.50%</span>
                            <input type="number" class="mix-rate-input" id="rateMalatz" value="4.50" step="0.1"
                                oninput="runSim()">
                        </div>
                        <input type="hidden" id="pctMalatz" value="33">
                    </div>

                    <div class="mix-row">
                        <span class="track-badge" style="background:#f97316"></span>
                        <div class="mix-label">Katz (CPI)</div>
                        <div class="mix-slider-container">
                            <input type="range" id="sliderKatz" min="0" max="100" step="1" value="0"
                                oninput="syncMixInput('Katz')">
                        </div>
                        <div class="mix-pct-val" id="dispKatz">0%</div>
                        <div class="mix-rate-box">
                            <span class="mix-rate-val" id="lblRateKatz" onclick="toggleRateEdit()">3.2% + CPI</span>
                            <input type="number" class="mix-rate-input" id="rateKatz" value="3.2" step="0.1"
                                oninput="runSim()">
                        </div>
                        <input type="hidden" id="pctKatz" value="0">
                    </div>

                    <div class="mix-row" style="margin-bottom:0;">
                        <span class="track-badge" style="background:#f43f5e"></span>
                        <div class="mix-label">Matz (CPI)</div>
                        <div class="mix-slider-container">
                            <input type="range" id="sliderMatz" min="0" max="100" step="1" value="0"
                                oninput="syncMixInput('Matz')">
                        </div>
                        <div class="mix-pct-val" id="dispMatz">0%</div>
                        <div class="mix-rate-box">
                            <span class="mix-rate-val" id="lblRateMatz" onclick="toggleRateEdit()">2.15% + CPI</span>
                            <input type="number" class="mix-rate-input" id="rateMatz" value="2.15" step="0.1"
                                oninput="runSim()">
                        </div>
                        <input type="hidden" id="pctMatz" value="0">
                    </div>

                    <!-- Early Repayments Section -->
                    <div class="prepay-section">
                        <div class="prepay-header" onclick="togglePrepaySection()">
                            <span>Early Repayments</span>
                            <span class="prepay-arrow" id="prepayArrow">+</span>
                        </div>
                        <div class="prepay-container" id="prepayContainer" style="display:none;">
                            <div id="prepayList"></div>
                            <button class="prepay-add-btn" onclick="addPrepayment()">+ Add Prepayment</button>
                        </div>
                    </div>

                    <div class="card-divider"></div>
                    <div class="card-row" style="margin-top:10px; gap:8px; align-items:center;">
                        <span class="card-lbl">Repayment Method</span>
                        <div class="pills" id="pRepayMethod">
                            <div class="pill active" id="repaySpitzer" onclick="setRepayMethod('spitzer')">Spitzer <span class="opt-star" id="starSpitzer">‚òÖ</span></div>
                            <div class="pill" id="repayEqualPrincipal" onclick="setRepayMethod('equalPrincipal')">Equal Principal <span class="opt-star" id="starEqual">‚òÖ</span></div>
                        </div>
                    </div>
                    <div class="card-row" style="margin-top:10px; gap:8px; align-items:center;">
                        <span class="card-lbl">Mortgage Term <span class="lock-toggle" id="lockTermBtn"
                                onclick="toggleLock('term')">Free</span></span>
                        <span class="card-val" id="dDur">25 Yr</span>
                        <div class="pill toggle" id="btnAdvancedTerm" onclick="toggleAdvancedTerms()"
                            style="margin-left:auto;">Advanced</div>
                    </div>
                    <div id="basicTermBox">
                        <div class="range-wrapper">
                            <input type="range" id="rDur" min="1" max="30" step="1" value="30" oninput="runSim()">
                            <div class="sweet-spot" id="spotDur"></div>
                        </div>
                    </div>
                    <div id="advancedTermBox" style="display:none; margin-top:8px;">
                        <div class="mix-row">
                            <div class="mix-label">Prime</div>
                            <input type="range" id="termPrime" min="1" max="30" step="1" value="30"
                                oninput="showTermVal('termPrimeVal', this.value); runSim()">
                            <span class="card-val" id="termPrimeVal" style="width:45px; text-align:right;">25y</span>
                        </div>
                        <div class="mix-row">
                            <div class="mix-label">Kalats</div>
                            <input type="range" id="termKalats" min="1" max="30" step="1" value="30"
                                oninput="showTermVal('termKalatsVal', this.value); runSim()">
                            <span class="card-val" id="termKalatsVal" style="width:45px; text-align:right;">25y</span>
                        </div>
                        <div class="mix-row">
                            <div class="mix-label">Malatz</div>
                            <input type="range" id="termMalatz" min="1" max="30" step="1" value="30"
                                oninput="showTermVal('termMalatzVal', this.value); runSim()">
                            <span class="card-val" id="termMalatzVal" style="width:45px; text-align:right;">25y</span>
                        </div>
                        <div class="mix-row">
                            <div class="mix-label">Katz</div>
                            <input type="range" id="termKatz" min="1" max="30" step="1" value="30"
                                oninput="showTermVal('termKatzVal', this.value); runSim()">
                            <span class="card-val" id="termKatzVal" style="width:45px; text-align:right;">25y</span>
                        </div>
                        <div class="mix-row">
                            <div class="mix-label">Matz</div>
                            <input type="range" id="termMatz" min="1" max="30" step="1" value="30"
                                oninput="showTermVal('termMatzVal', this.value); runSim()">
                            <span class="card-val" id="termMatzVal" style="width:45px; text-align:right;">25y</span>
                        </div>
                        <div class="card-sub">Use Advanced to set different terms per track. Click again to revert to
                            single term.</div>
                    </div>

                    <div class="card-divider"></div>
                    <div class="card-row" style="margin-bottom:10px;">
                        <span class="card-lbl">Credit Score</span>
                        <span class="card-val" id="creditScoreVal">900-950</span>
                    </div>
                    <div class="range-wrapper">
                        <input type="range" id="creditScore" min="650" max="950" step="50" value="900"
                            oninput="setCreditScore(this.value)">
                    </div>
                    <div class="card-sub" id="creditTierLabel">Risk Tier: Standard</div>
                    <div class="card-sub danger" id="creditWarn" style="display:none;">Application rejected: score below
                        660</div>
                </div>

                <div class="control-card" style="border-left:3px solid var(--secondary); margin-top:15px;">
                    <div class="card-row"><span class="card-lbl">Simulation Timeframe <span class="lock-toggle locked"
                                id="lockHorBtn" onclick="toggleLock('hor')">Locked</span></span> <span class="card-val"
                            id="dHor">Auto</span></div>
                    <div class="pills" id="pHor">
                        <div class="pill active" onclick="tglHor(true)">Auto</div>
                        <div class="pill" onclick="tglHor(false)">Custom</div>
                    </div>
                    <div class="input-box" id="bHor">
                        <div class="range-wrapper">
                            <input type="range" id="rHor" min="1" max="50" step="1" value="25" oninput="runSim()">
                            <div class="sweet-spot" id="spotHor"></div>
                        </div>
                    </div>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:end; margin-top:15px;">
                    <div class="section-title" style="margin:0">Market Variables</div>
                    <div class="pills" id="pGlobal">
                        <div class="pill" onclick="setGlobalMode(true)">Hist</div>
                        <div class="pill active" onclick="setGlobalMode(false)">Fixed</div>
                    </div>
                </div>

                <div class="scenario-box" id="scenBox">
                    <div
                        style="font-size:0.7rem; font-weight:800; color:#64748b; letter-spacing:0.05em; margin-bottom:4px;">
                        QUICK SCENARIOS</div>
                    <div class="scenario-grid">
                        <div class="scen-btn bear" id="scenBear" onclick="applyScenario('bear')">üêª Bear</div>
                        <div class="scen-btn base active" id="scenBase" onclick="applyScenario('base')">üòê Base</div>
                        <div class="scen-btn bull" id="scenBull" onclick="applyScenario('bull')">üöÄ Bull</div>
                    </div>
                </div>

                <div class="control-card">
                    <!-- RE APPRECIATION -->
                    <div class="card-row"><span class="card-lbl">Home Appreciation</span> <span class="card-val"
                            id="vApp">Fixed</span></div>
                    <div class="pills" id="pApp">
                        <div class="pill" onclick="tgl('App',true)">Hist</div>
                        <div class="pill active" onclick="tgl('App',false)">Fixed</div>
                    </div>
                    <div class="input-box show" id="bApp"><input type="range" id="sApp" min="0" max="10" step="0.5"
                            value="4" oninput="runSim()"></div>

                    <div style="margin-top:12px; padding-top:8px; border-top:1px solid #f1f5f9;">
                        <div class="card-row"><span class="card-lbl">Rental Yield</span> <span class="card-val"
                                id="vYld">Fixed</span></div>
                        <div class="pills" id="pYld">
                            <div class="pill" onclick="tgl('Yld',true)">Hist</div>
                            <div class="pill active" onclick="tgl('Yld',false)">Fixed</div>
                        </div>
                        <div class="input-box show" id="bYld"><input type="range" id="sYld" min="1.5" max="6" step="0.1"
                                value="3.0" oninput="runSim()"></div>
                        <label class="chk-row" style="margin-top:10px;">
                            <input type="checkbox" id="cRentTax" checked onchange="runSim()">
                            <span>Rent Tax (10% > 5.6k)</span>
                        </label>
                    </div>
                </div>

                <div class="control-card">
                    <div class="card-row"><span class="card-lbl">S&P 500 Return</span> <span class="card-val"
                            id="vSP">Fixed</span></div>
                    <div class="pills" id="pSP">
                        <div class="pill" onclick="tgl('SP',true)">Hist</div>
                        <div class="pill active" onclick="tgl('SP',false)">Fixed</div>
                    </div>
                    <div class="input-box show" id="bSP"><input type="range" id="sSP" min="4" max="15" step="0.5"
                            value="9" oninput="runSim()"></div>

                    <div class="fees-box">
                        <div class="card-row" style="margin-bottom:2px;"><span class="card-lbl"
                                style="font-weight:400; font-size:0.7rem">Annual Mgmt Fee</span><span class="card-val"
                                style="font-size:0.7rem" id="vMer">0%</span></div>
                        <input type="range" id="rMer" min="0" max="1.0" step="0.05" value="0.15" oninput="runSim()">
                        <div class="card-row" style="margin-bottom:2px; margin-top:6px;"><span class="card-lbl"
                                style="font-weight:400; font-size:0.7rem">Deposit Fee</span><span class="card-val"
                                style="font-size:0.7rem" id="vTrade">0%</span></div>
                        <input type="range" id="rTrade" min="0" max="1.0" step="0.05" value="0.1" oninput="runSim()">
                        <div class="card-row" style="margin-top:12px;">
                            <span class="card-lbl">Rent Surplus</span>
                            <div style="display:flex; flex-direction:column; width:60%;">
                                <div class="pills" id="surplusPills" style="width:100%;">
                                    <div class="pill" id="surplusInvest" onclick="setSurplusMode('invest')"
                                        style="flex:1; text-align:center;">Reinvest</div>
                                    <div class="pill" id="surplusConsume" onclick="setSurplusMode('consume')"
                                        style="flex:1; text-align:center;">Pocket</div>
                                    <div class="pill active" id="surplusMatch" onclick="setSurplusMode('match')"
                                        style="flex:1; text-align:center;">Match</div>
                                </div>
                                <div id="surplusDescText" class="card-sub"
                                    style="margin-top:4px; text-align:right; font-size:0.65rem;">Sells S&P 500 to match
                                    rent surplus cashflow</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-card">
                    <div class="card-row"><span class="card-lbl">Interest (Base)</span> <span class="card-val"
                            id="vInt">Fixed</span></div>
                    <div class="pills" id="pInt">
                        <div class="pill" onclick="tgl('Int',true)">Hist</div>
                        <div class="pill active" onclick="tgl('Int',false)">Fixed</div>
                    </div>
                    <div class="input-box show" id="bInt">
                        <input type="range" id="sInt" min="1" max="8" step="0.25" value="4.25" oninput="syncPrime()">
                        <div style="font-size:0.65rem; color:#64748b; margin-top:4px;">*Affects Prime Rate (BoI + 1.5%)
                        </div>
                    </div>
                </div>

                <div class="control-card">
                    <div class="card-row"><span class="card-lbl">Inflation (CPI)</span> <span class="card-val"
                            id="vInf">Fixed</span></div>
                    <div class="pills" id="pInf">
                        <div class="pill" onclick="tgl('Inf',true)">Hist</div>
                        <div class="pill active" onclick="tgl('Inf',false)">Fixed</div>
                    </div>
                    <div class="input-box show" id="bInf">
                        <input type="range" id="sInf" min="0" max="6" step="0.5" value="2.5"
                            oninput="updMeter(); runSim()">
                        <div class="meter" id="infMeter">
                            <div class="meter-seg" style="background:#86efac"></div>
                            <div class="meter-seg" style="background:#fcd34d"></div>
                            <div class="meter-seg" style="background:#fca5a5"></div>
                        </div>
                    </div>
                </div>

                <div class="section-title">Hidden Costs & Friction</div>
                <div class="control-card">
                    <div class="card-row"><span class="card-lbl">Purchase Discount</span> <span class="card-val"
                            id="vDiscount">1%</span></div>
                    <input type="range" id="rDiscount" min="-10" max="10" step="1" value="1" oninput="runSim()">
                    <div class="card-sub">Below market price (negative = overpay)</div>

                    <div class="card-row" style="margin-top:8px;"><span class="card-lbl">Buying Friction</span> <span class="card-val"
                            id="vBuyCost">2.0%</span></div>
                    <input type="range" id="rBuyCost" min="0" max="15" step="0.5" value="2.0" oninput="runSim()">
                    <div class="card-sub">Entry costs (legal/registration; no purchase tax/broker)</div>

                    <div class="card-row" style="margin-top:8px;"><span class="card-lbl">Maint. & Vacancy</span> <span
                            class="card-val" id="vMaint">8%</span></div>
                    <input type="range" id="rMaint" min="0" max="30" step="1" value="8" oninput="runSim()">
                    <div class="card-sub">% of Gross Rent lost annually</div>

                    <div class="card-row" style="margin-top:8px;"><span class="card-lbl">Selling Friction</span> <span
                            class="card-val" id="vSellCost">2.0%</span></div>
                    <input type="range" id="rSellCost" min="0" max="10" step="0.5" value="2.0" oninput="runSim()">
                    <div class="card-sub">Agent & Lawyer at Exit</div>
                </div>

                <div class="section-title">Advanced Configuration</div>
                <div class="control-card" style="border-left:3px solid #8b5cf6">
                    <div class="card-row"><span class="card-lbl">Taxation Basis</span> <span class="card-val"
                            id="vTaxMode">Real</span></div>
                    <div class="select-list">
                        <div class="select-item active" id="txReal" onclick="setTaxMode('real')">
                            <div class="radio"></div><span class="item-text">Real (vs Inflation)</span>
                        </div>
                        <div class="select-item" id="txForex" onclick="setTaxMode('forex')">
                            <div class="radio"></div><span class="item-text">Nominal (vs USD)</span>
                        </div>
                    </div>
                    <label class="chk-row" style="margin-top:8px;"><input type="checkbox" id="cTax" checked
                            onchange="runSim()"> Apply 25% Tax on Profit</label>
                </div>
                <br><br>
            </div>
        </div>

        <div class="main">
            <div class="kpi-grid">
                <div class="kpi-box kpi-re">
                    <div class="kpi-num" style="color:var(--success)" id="kRECagr">0%</div>
                    <div class="kpi-lbl">RE Annual ROI</div>
                </div>
                <div class="kpi-box kpi-sp">
                    <div class="kpi-num" style="color:var(--primary)" id="kSPCagr">0%</div>
                    <div class="kpi-lbl">S&P Annual ROI</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-num" style="color:#64748b" id="kDiff">0</div>
                    <div class="kpi-lbl">ROI Difference</div>
                </div>
                <div class="kpi-box kpi-re-border">
                    <div class="kpi-num" style="color:var(--success)" id="kRE">0</div>
                    <div class="kpi-lbl">Real Estate Net</div>
                </div>
                <div class="kpi-box kpi-sp-border">
                    <div class="kpi-num" style="color:var(--primary)" id="kSP">0</div>
                    <div class="kpi-lbl">S&P 500 Net</div>
                </div>
                <div class="kpi-box kpi-bad">
                    <div class="kpi-num wrap" style="color:#e11d48" id="kInt">0</div>
                    <div class="kpi-lbl">Interest Paid</div>
                </div>
                <div class="kpi-box kpi-good">
                    <div class="kpi-num" style="color:#15803d" id="kRent">0</div>
                    <div class="kpi-lbl">Rent Collected</div>
                </div>
            </div>

            <div class="inline-summary" style="margin-top:0; margin-bottom:8px;">
                <div class="inline-spec">
                    <span class="inline-label">Asset Price</span>
                    <span class="inline-value" id="valAsset">1.8M</span>
                </div>
                <div class="inline-spec">
                    <span class="inline-label">Mortgage</span>
                    <span class="inline-value" id="valMortgage">1.2M</span>
                </div>
                <div class="inline-spec">
                    <span class="inline-label">Leverage</span>
                    <span class="inline-value" id="valLev">x3.3</span>
                    <div class="lev-bar-bg compact">
                        <div class="lev-bar-fill" id="barLev"></div>
                    </div>
                </div>
                <div class="inline-spec">
                    <span class="inline-label">Years to +CF</span>
                    <span class="inline-value" id="valPosCF">--</span>
                </div>
                <div class="inline-spec">
                    <span class="inline-label">Money Invested</span>
                    <span class="inline-value" id="kInvested">0</span>
                </div>
            </div>

            <div class="charts-warning" id="chartsWarn" style="display:none;">Mix must total 100% of mortgage to view
                charts</div>
            <div class="charts-container" id="chartsContainer">
                <div class="chart-wrapper">
                    <div class="chart-title">Net Wealth Accumulation</div>
                    <div style="position:relative; flex:1;">
                        <canvas id="wealthChart"></canvas>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">Monthly Cashflow (Revenue vs Cost)</div>
                    <div style="position:relative; flex:1;">
                        <canvas id="flowChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="./logic.js"></script>
    <script src="./app.js"></script>
</body>

</html>
